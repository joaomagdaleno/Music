00:00 +0: loading C:/Users/joaom/Documents/GitHub/Music/music_tag_editor/test/all_services_test.dart
00:00 +0: AuthService AuthService login success returns true
00:00 +1: AuthService AuthService login failure returns false
Login error: [firebase_auth/user-not-found] null
00:00 +2: AuthService AuthService register success returns true
00:00 +3: AuthService AuthService logout calls signOut
00:00 +4: AuthService AuthService recoverVaultAccess returns true if user matches
00:00 +5: BackupService BackupService createBackup creates a zip file with data
00:00 +6: BackupService BackupService restoreBackup restores data from zip
00:00 +7: BackupService BackupService estimateBackupSize returns valid size
00:00 +8: ConnectivityRoot ConnectivityService instance is accessible
00:00 +9: ConnectivityRoot ConnectivityService isOffline is a ValueNotifier
00:00 +9 -1: ConnectivityRoot ConnectivityService isOffline is a ValueNotifier [E]
  type 'Null' is not a subtype of type 'ValueNotifier<bool>'
  test\test_helper.dart 33:7                  MockConnectivityService.isOffline
  test\connectivity_service.suite.dart 16:40  main.<fn>.<fn>
  
00:00 +9 -1: ConnectivityRoot ConnectivityService init completes without error
00:00 +10 -1: DatabaseService (setUpAll)
00:00 +10 -1: DatabaseService Settings save and load filename format
00:01 +11 -1: DatabaseService Settings save and load crossfade duration
00:01 +12 -1: DatabaseService Settings save and load age bypass
00:01 +13 -1: DatabaseService Tracks save and retrieve tracks
00:01 +14 -1: DatabaseService Tracks toggle vault
00:01 +15 -1: DatabaseService Tracks trackPlay increments count and sets lastPlayed
00:01 +16 -1: DatabaseService Playlists create playlist and add tracks
00:01 +17 -1: DatabaseService Duo save guest and add session tracks
00:01 +18 -1: DatabaseService Moods getTracksByMood returns matching genres
00:01 +19 -1: DatabaseService Learning Rules save and get learning rules
00:01 +20 -1: DatabaseService (tearDownAll)
00:01 +20 -1: DatabaseServiceNew DatabaseService instance is accessible
00:01 +21 -1: DatabaseServiceNew FilenameFormat generateFilename returns string
00:01 +22 -1: DatabaseServiceNew FilenameFormat generateFilename handles titleArtist
00:01 +23 -1: DatabaseServiceNew LearningChoice has expected values
00:01 +24 -1: DownloadService DownloadService - Platform Detection detects YouTube correctly
00:01 +24 -2: DownloadService DownloadService - Platform Detection detects YouTube correctly [E]
  type 'Null' is not a subtype of type 'MediaPlatform'
  test\test_helper.dart 43:7              MockDownloadService.detectPlatform
  test\download_service.suite.dart 20:22  main.<fn>.<fn>
  
Warning: At least one test in this suite creates an HttpClient. When running a test suite that uses
TestWidgetsFlutterBinding, all HTTP requests will return status code 400, and no network request
will actually be made. Any test expecting a real network connection and status code will fail.
To test code that needs an HttpClient, provide your own HttpClient implementation to the code under
test, so that your test can consistently provide a testable response to the code under test.
00:01 +24 -2: DownloadService DownloadService - Platform Detection detects YouTube Music correctly
00:01 +24 -3: DownloadService DownloadService - Platform Detection detects YouTube Music correctly [E]
  type 'Null' is not a subtype of type 'MediaPlatform'
  test\test_helper.dart 43:7              MockDownloadService.detectPlatform
  test\download_service.suite.dart 27:22  main.<fn>.<fn>
  
00:01 +24 -3: DownloadService DownloadService - Platform Detection detects Spotify correctly
00:01 +24 -4: DownloadService DownloadService - Platform Detection detects Spotify correctly [E]
  type 'Null' is not a subtype of type 'MediaPlatform'
  test\test_helper.dart 43:7              MockDownloadService.detectPlatform
  test\download_service.suite.dart 32:22  main.<fn>.<fn>
  
00:01 +24 -4: DownloadService DownloadService - Platform Detection returns unknown for invalid URLs
00:01 +24 -5: DownloadService DownloadService - Platform Detection returns unknown for invalid URLs [E]
  type 'Null' is not a subtype of type 'MediaPlatform'
  test\test_helper.dart 43:7              MockDownloadService.detectPlatform
  test\download_service.suite.dart 37:22  main.<fn>.<fn>
  
00:01 +24 -5: DownloadService DownloadService - Media Info getMediaInfo returns YouTube info correctly
00:01 +24 -6: DownloadService DownloadService - Media Info getMediaInfo returns YouTube info correctly [E]
  type 'Null' is not a subtype of type 'Future<MediaInfo>'
  test\test_helper.dart 43:7              MockDownloadService.getMediaInfo
  test\download_service.suite.dart 85:25  main.<fn>.<fn>
  
00:01 +24 -6: DownloadService DownloadService - Media Info getMediaInfo returns Spotify info correctly
00:01 +24 -7: DownloadService DownloadService - Media Info getMediaInfo returns Spotify info correctly [E]
  type 'Null' is not a subtype of type 'Future<MediaInfo>'
  test\test_helper.dart 43:7              MockDownloadService.getMediaInfo
  test\download_service.suite.dart 95:25  main.<fn>.<fn>
  
00:01 +24 -7: EqualizerRoot EqualizerService Tests Normalization calculation
00:01 +25 -7: EqualizerRoot EqualizerService Tests Normalization disabled returns 1.0
00:01 +26 -7: EqualizerRoot EqualizerService Tests Auto mode state
00:01 +27 -7: FirebaseSync (setUpAll)
00:01 +27 -7: FirebaseSync enableSync signs in anonymously if not signed in
00:01 +28 -7: FirebaseSync pullFromCloud pulls tracks and playlists
00:01 +29 -7: FirebaseSync (tearDownAll)
00:01 +29 -7: LocalDuoService (setUpAll)
00:01 +29 -7: LocalDuoService LocalDuoService startHost sets role and starts advertising
00:01 +30 -7: LocalDuoService LocalDuoService startDiscovery sets role and starts discovery
00:01 +31 -7: LocalDuoService LocalDuoService stopAll cleans up state
00:01 +32 -7: LocalDuoService LocalDuoService sendMessage sends bytes to all connected endpoints
00:01 +33 -7: LocalDuoService LocalDuoService sendFile sends file to all connected endpoints
00:01 +34 -7: LocalDuoService LocalDuoService handleIncomingMessage play/pause/seek
00:01 +35 -7: LocalDuoService LocalDuoService handleIncomingMessage track/chat
00:01 +36 -7: LocalDuoService (tearDownAll)
00:01 +36 -7: LyricsService LyricsService fetchLyrics returns empty list on network error
00:01 +37 -7: LyricsService LyricsService _parseLrc parses valid LRC format
00:01 +38 -7: LyricsService LyricsService LyricLine has correct structure
00:01 +39 -7: LyricsService LyricsService multiple LyricLines can be created
00:01 +40 -7: MetadataAggregator aggregateMetadata aggregates results correctly with majority vote
00:01 +41 -7: MetadataAggregator aggregateMetadata handles empty results
00:01 +42 -7: MetadataAggregator fetchSyncedLyrics returns lyrics from LrcLib if found and valid
00:01 +43 -7: MetadataAggregator fetchSyncedLyrics falls back to Netease if LrcLib empty
00:01 +44 -7: MetadataCleanup MetadataCleanupService cleanupLibrary cleans dirty titles and artists
00:01 +45 -7: MetadataCleanup MetadataCleanupService cleanupLibrary fetches missing metadata
00:01 +46 -7: MetadataCleanup MetadataCleanupService cleanupLibrary handles aggregator errors gracefully
00:01 +47 -7: MetadataService MetadataService Tests Read and Write Metadata
00:01 +48 -7: MetadataService MetadataService Tests Read non-existent file throws exception
00:02 +49 -7: MetadataService MetadataService Tests Write to non-existent file throws exception
00:02 +50 -7: PersonaService PersonaService Unit Tests Default persona should be listener
00:02 +51 -7: PersonaService PersonaService Unit Tests setPersona updates activePersona and notifies listeners
00:02 +52 -7: PlaybackService PlaybackService - Core Logic playSearchResult sets source and plays
00:02 +53 -7: PlaybackService PlaybackService - Core Logic pause calls player pause and sends message
00:02 +54 -7: PlaybackService PlaybackService - Core Logic resume calls player play and sends message
00:02 +55 -7: PlaybackService PlaybackService - Core Logic stop calls player stop
00:02 +56 -7: PlaybackService PlaybackService - Core Logic seek calls player seek and sends message
00:02 +57 -7: PlaybackService PlaybackService - Core Logic addToQueue adds track and notifies remote
00:02 +58 -7: PlaybackService PlaybackService - Core Logic clearQueue empties the queue
00:02 +59 -7: PlaybackService PlaybackService - Core Logic setSleepTimer stops playback after duration
00:02 +60 -7: PlaybackService PlaybackService - Core Logic cancelSleepTimer resets status
00:02 +61 -7: SearchService searchYouTube parses yt-dlp json output correctly
00:02 +61 -8: SearchService searchYouTube parses yt-dlp json output correctly [E]
  type 'Null' is not a subtype of type 'Future<List<SearchResult>>'
  test\test_helper.dart 41:7            MockSearchService.searchYouTube
  test\search_service.suite.dart 75:37  main.<fn>.<fn>
  
00:02 +61 -8: SearchService searchYouTube returns empty list on process error
00:02 +61 -9: SearchService searchYouTube returns empty list on process error [E]
  type 'Null' is not a subtype of type 'Future<List<SearchResult>>'
  test\test_helper.dart 41:7            MockSearchService.searchYouTube
  test\search_service.suite.dart 86:37  main.<fn>.<fn>
  
00:02 +61 -9: SearchService searchYouTubeMusic parses yt-music output with album info
00:02 +61 -10: SearchService searchYouTubeMusic parses yt-music output with album info [E]
  type 'Null' is not a subtype of type 'Future<List<SearchResult>>'
  test\test_helper.dart 41:7             MockSearchService.searchYouTubeMusic
  test\search_service.suite.dart 105:37  main.<fn>.<fn>
  
00:02 +61 -10: SearchService searchHiFi delegates to HiFiDownloadService
00:02 +61 -11: SearchService searchHiFi delegates to HiFiDownloadService [E]
  type 'Null' is not a subtype of type 'Future<List<SearchResult>>'
  test\test_helper.dart 41:7             MockSearchService.searchHiFi
  test\search_service.suite.dart 127:37  main.<fn>.<fn>
  
00:02 +61 -11: SearchService getStreamUrl returns trimmed stdout on success
00:02 +61 -12: SearchService getStreamUrl returns trimmed stdout on success [E]
  type 'Null' is not a subtype of type 'Future<String?>'
  test\test_helper.dart 41:7             MockSearchService.getStreamUrl
  test\search_service.suite.dart 138:33  main.<fn>.<fn>
  
00:02 +61 -12: SearchService getStreamUrl returns null on failure
00:02 +61 -13: SearchService getStreamUrl returns null on failure [E]
  type 'Null' is not a subtype of type 'Future<String?>'
  test\test_helper.dart 41:7             MockSearchService.getStreamUrl
  test\search_service.suite.dart 144:33  main.<fn>.<fn>
  
00:02 +61 -13: SearchService searchAll calls all platforms and updates status
00:02 +61 -14: SearchService searchAll calls all platforms and updates status [E]
  type 'Null' is not a subtype of type 'Future<List<SearchResult>>'
  test\test_helper.dart 41:7             MockSearchService.searchAll
  test\search_service.suite.dart 156:21  main.<fn>.<fn>
  
00:02 +61 -14: SecurityService SecurityService instance is accessible
00:02 +62 -14: SecurityService SecurityService encryptString returns encrypted format
00:02 +63 -14: SecurityService SecurityService decryptString returns original text
00:02 +64 -14: SecurityService SecurityService decryptString handles invalid format gracefully
00:02 +65 -14: SecurityService SecurityService _hashPassword produces consistent hash
00:02 +66 -14: SecurityService SecurityService unlockVault returns false without setup
00:02 +67 -14: SecurityService SecurityService setupVaultPassword allows unlocking
00:02 +68 -14: ThemeRoot ThemeService instance is accessible
00:02 +69 -14: ThemeRoot ThemeService primaryColor returns a Color
00:02 +69 -15: ThemeRoot ThemeService primaryColor returns a Color [E]
  type 'Null' is not a subtype of type 'Color'
  test\test_helper.dart 31:7           MockThemeService.primaryColor
  test\theme_service.suite.dart 15:43  main.<fn>.<fn>
  
00:02 +69 -15: ThemeRoot ThemeService setCustomColor updates color
00:02 +70 -15: ThemeRoot ThemeService ThemeService is a ChangeNotifier
00:02 +71 -15: CastService (setUpAll)
00:02 +71 -15: CastService CastService parseSsdpResponse adds device to stream on valid XML
00:02 +72 -15: CastService CastService sendSoap sends correct POST request
00:02 +73 -15: CastService CastService parseSsdpResponse handles partial URLs in controlURL
00:02 +74 -15: CastService (tearDownAll)
00:02 +74 -15: ConnectivityService ConnectivityService init updates isOffline status correctly
00:02 +75 -15: ConnectivityService ConnectivityService Becomes online when wifi connected
00:02 +76 -15: DesktopIntegration (setUpAll)
00:02 +76 -15: DesktopIntegration init calls initialization methods
00:02 +77 -15: DesktopIntegration hideToTray calls windowManager.hide()
00:02 +78 -15: DesktopIntegration (tearDownAll)
00:02 +78 -15: EqualizerService EqualizerService applyPresetForGenre sets bands correctly for Rock
00:02 +79 -15: EqualizerService EqualizerService calculateNormalizedVolume calculates gain adjustment
00:02 +80 -15: HifiDownload HiFiDownloadService search returns sorted results
00:02 +81 -15: HifiDownload HiFiDownloadService download handles success
00:02 +82 -15: HifiDownload HiFiDownloadService download handles failure to get link
00:02 +83 -15: HifiDownload HiFiDownloadService findHiFiVersion finds match
00:02 +84 -15: ListeningStats ListeningStatsService getStats calculates basic totals correctly
00:02 +85 -15: ListeningStats ListeningStatsService getStats identifies top items correctly
00:02 +86 -15: ListeningStats ListeningStatsService getStats handles empty database
00:02 +87 -15: ThemeService ThemeService init loads settings from DB
00:02 +88 -15: ThemeService ThemeService setCustomColor saves to DB and updates state
00:02 +89 -15: ThemeService ThemeService updateThemeFromImage updates primary color from palette
00:03 +90 -15: Some tests failed.
